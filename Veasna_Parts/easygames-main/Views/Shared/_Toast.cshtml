@* Reusable Bootstrap toast. 
   - Shows TempData["Toast"] if the server set one.
   - Otherwise, if localStorage.eg_toast exists (set by JS on Add-to-Cart submit), it shows that.
   - Styling matches  glass look and sits bottom-right. *@
@{
    var serverToast = TempData["Toast"] as string;
}
<div aria-live="polite" aria-atomic="true" class="position-fixed" style="z-index:1080; right:1rem; bottom:1rem;">
    <div id="eg-toast" class="toast align-items-center border-0 shadow"
         role="alert" aria-live="assertive" aria-atomic="true"
         data-bs-delay="2200" data-bs-autohide="true"
         style="backdrop-filter:saturate(140%) blur(8px);
                background:linear-gradient(135deg, rgba(129,79,247,.15), rgba(203,157,255,.18));">
        <div class="d-flex">
            <div id="eg-toast-body" class="toast-body fw-medium">@serverToast</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<script>
    (function () {
        //  any form that posts to /Cart/Add is submitted, mark a toast message
        document.addEventListener('submit', function (e) {
            const f = e.target;
            if (f && f.tagName === 'FORM') {
                const action = (f.getAttribute('action') || '').toLowerCase();
                if (action.includes('/cart/add')) {
                    try { localStorage.setItem('eg_toast', 'Added to cart!'); } catch { }
                }
            }
        }, true);

        // on load, show either server provided toast or the stored client toast
        var msg = "@(serverToast ?? "")";
        if (!msg) {
            try {
                msg = localStorage.getItem('eg_toast') || '';
                if (msg) localStorage.removeItem('eg_toast');
            } catch { msg = ''; }
        }

        if (msg) {
            const el = document.getElementById('eg-toast');
            const body = document.getElementById('eg-toast-body');
            if (el && body && window.bootstrap?.Toast) {
                body.textContent = msg;
                const t = new bootstrap.Toast(el);
                t.show();
            }
        }
    })();
</script>
